# 요구사항 명세서

## 문서 정보
- **프로젝트**: 마크다운 뷰어 V2
- **버전**: 1.0
- **작성일**: 2026-01-29
- **기반 문서**: SYSTEM_ARCHITECTURE.md

## 목차
1. [개요](#개요)
2. [기능 요구사항](#기능-요구사항)
3. [비기능 요구사항](#비기능-요구사항)
4. [사용자 스토리](#사용자-스토리)
5. [제약사항](#제약사항)
6. [우선순위](#우선순위)

---

## 개요

### 프로젝트 목적
Google 로그인 기반의 안전하고 사용하기 편한 마크다운 뷰어 및 에디터를 제공하여 사용자가 어디서나 자신의 마크다운 문서를 관리하고 편집할 수 있도록 합니다.

### 핵심 가치
- **보안**: 개인 파일의 프라이버시 보호 (클라이언트 사이드 암호화)
- **편의성**: 직관적인 아이콘 기반 UI, 자동 저장
- **접근성**: 웹 기반으로 어디서나 접근 가능
- **확장성**: 1000명 이상의 동시 사용자 지원

---

## 기능 요구사항

### FR-1: 인증 및 사용자 관리

#### FR-1.1: Google 로그인
- **우선순위**: 필수 (Must Have)
- **설명**: Google OAuth 2.0을 통한 사용자 인증
- **상세 요구사항**:
  - Google 계정으로 로그인 가능
  - 로그인 후 JWT 토큰 발급
  - 세션 유지 (토큰 기반)
  - 로그아웃 기능

#### FR-1.2: 사용자별 폴더 관리
- **우선순위**: 필수 (Must Have)
- **설명**: 각 사용자마다 독립적인 폴더 구조 제공
- **상세 요구사항**:
  - 로그인 시 사용자별 폴더 자동 생성 (`/users/{userId}/files/`)
  - 다른 사용자의 파일 접근 불가
  - 사용자별 저장 공간 할당량 관리 (기본 1GB)

#### FR-1.3: 비로그인 뷰어 접근
- **우선순위**: 필수 (Must Have)
- **설명**: 로그인 없이도 뷰어 화면에 접근하여 제한된 기능 사용 가능
- **상세 요구사항**:
  - 메인(로그인) 페이지에서 "로그인 없이 뷰어 시작" 버튼 제공
  - 비로그인 시 뷰어 페이지 접근 가능 (빈 화면 또는 로컬 파일만 사용)
  - 비로그인 시 서버 파일 목록/저장/업로드 등은 불가, 로컬 파일 열기·저장만 가능
  - 뷰어에서 사용자 아이콘 클릭 시 로그인 페이지로 이동

### FR-2: 파일 관리

#### FR-2.1: 파일 목록 조회
- **우선순위**: 필수 (Must Have)
- **설명**: 사용자의 파일 목록을 조회할 수 있어야 함
- **상세 요구사항**:
  - 폴더 트리 구조 표시
  - 파일명, 수정일, 크기 표시
  - 폴더별 파일 그룹화
  - 검색 기능

#### FR-2.2: 파일 읽기
- **우선순위**: 필수 (Must Have)
- **설명**: 마크다운 파일을 읽어서 렌더링된 HTML로 표시
- **상세 요구사항**:
  - URL 파라미터로 파일 열기 (`?file=path/to/file.md`)
  - 드래그앤드롭으로 파일 열기
  - 마지막 수정 문서 자동 로드
  - 코드 하이라이팅 지원
  - 표, 목록, 링크 등 마크다운 요소 지원

#### FR-2.3: 파일 저장
- **우선순위**: 필수 (Must Have)
- **설명**: 편집한 내용을 파일로 저장
- **상세 요구사항**:
  - 수동 저장 (Ctrl+S 또는 저장 버튼)
  - 자동 저장 (3분마다 또는 변경사항 누적 시)
  - 저장 상태 표시 ("저장됨", "저장 중...", "저장 실패")
  - 저장 성공/실패 알림

#### FR-2.4: 파일 업로드
- **우선순위**: 필수 (Must Have)
- **설명**: 로컬 파일을 서버에 업로드
- **상세 요구사항**:
  - 마크다운 파일만 업로드 가능 (.md, .markdown)
  - 파일 크기 제한 (16MB)
  - 한글 파일명 지원
  - 업로드 후 자동 파일 열기

#### FR-2.5: 파일 삭제
- **우선순위**: 필수 (Must Have)
- **설명**: 파일을 삭제할 수 있어야 함
- **상세 요구사항**:
  - 삭제 확인 다이얼로그
  - 일반 삭제 및 안전 삭제 옵션
  - 삭제 후 파일 목록 갱신

### FR-3: 마크다운 편집

#### FR-3.1: 편집 모드
- **우선순위**: 필수 (Must Have)
- **설명**: 마크다운 파일을 편집할 수 있어야 함
- **상세 요구사항**:
  - 더블클릭 또는 편집 아이콘으로 편집 모드 진입
  - 전체 화면 편집 모드
  - 실시간 편집 가능
  - 편집 모드 표시 인디케이터

#### FR-3.2: Smart Paste
- **우선순위**: 필수 (Must Have)
- **설명**: 붙여넣기 시 마크다운 형식 자동 인식
- **상세 요구사항**:
  - 붙여넣은 텍스트의 마크다운 패턴 감지
  - 자동으로 마크다운 형식 적용
  - 일반 텍스트와 구분하여 처리

#### FR-3.3: 편집 종료
- **우선순위**: 필수 (Must Have)
- **설명**: 편집을 종료하고 뷰어 모드로 전환
- **상세 요구사항**:
  - 저장되지 않은 변경사항 확인
  - 저장 후 닫기 / 저장하지 않고 닫기 / 취소 옵션
  - 페이지를 떠날 때도 확인 (beforeunload)

### FR-4: 파일 보안

#### FR-4.1: 파일 암호화
- **우선순위**: 필수 (Must Have)
- **설명**: 중요한 파일을 암호화하여 저장
- **상세 요구사항**:
  - 클라이언트 사이드 암호화 (AES-256-GCM)
  - 사용자 비밀번호 기반 키 파생 (PBKDF2)
  - 서버는 암호화된 데이터만 저장
  - 암호화 여부 선택 가능

#### FR-4.2: 로컬 전용 모드
- **우선순위**: 필수 (Must Have)
- **설명**: 서버에 저장하지 않고 로컬에서만 작업
- **상세 요구사항**:
  - 로컬 파일 시스템에만 저장
  - File System Access API 지원
  - 다운로드 기능 제공

#### FR-4.3: 안전한 파일 삭제
- **우선순위**: 권장 (Should Have)
- **설명**: 파일 삭제 시 데이터 완전 제거
- **상세 요구사항**:
  - 랜덤 데이터로 덮어쓰기 후 삭제
  - DoD 5220.22-M 표준 준수

### FR-5: 사용자 경험

#### FR-5.1: 마지막 문서 자동 로드
- **우선순위**: 필수 (Must Have)
- **설명**: 로그인 후 마지막으로 수정하던 문서 자동 로드
- **상세 요구사항**:
  - localStorage에서 마지막 문서 경로 확인
  - 없으면 서버에서 마지막 수정 문서 조회
  - 자동으로 파일 열기

#### FR-5.2: 자동 저장
- **우선순위**: 필수 (Must Have)
- **설명**: 편집 중 자동으로 저장
- **상세 요구사항**:
  - localStorage에 즉시 저장
  - 3분마다 서버에 저장
  - 변경사항 누적 시 자동 저장
  - 저장 상태 표시

#### FR-5.3: 백그라운드 업데이트 방지
- **우선순위**: 필수 (Must Have)
- **설명**: 탭이 비활성화되어 있을 때 자동 새로고침 중지
- **상세 요구사항**:
  - Page Visibility API 사용
  - 탭이 숨겨지면 파일 변경 감지 중지
  - 탭이 다시 활성화되면 한 번만 체크

#### FR-5.4: 직관적인 아이콘 기반 UI
- **우선순위**: 필수 (Must Have)
- **설명**: 텍스트 대신 아이콘으로 기능 표시
- **상세 요구사항**:
  - Font Awesome 아이콘 사용
  - 아이콘에 툴팁 제공
  - 접근성 고려 (ARIA labels)

### FR-6: 광고 통합

#### FR-6.1: Google AdSense 통합
- **우선순위**: 필수 (Must Have)
- **설명**: 광고를 통한 수익화
- **상세 요구사항**:
  - 페이지 하단에 광고 영역 배치
  - Google AdSense 스크립트 통합
  - 반응형 광고 표시
  - 설정 파일로 광고 ID 관리

---

## 비기능 요구사항

### NFR-1: 성능

#### NFR-1.1: 응답 시간
- **우선순위**: 필수 (Must Have)
- **요구사항**:
  - 파일 읽기: 1초 이내
  - 파일 저장: 2초 이내
  - 마크다운 렌더링: 500ms 이내
  - 페이지 로드: 3초 이내

#### NFR-1.2: 처리량
- **우선순위**: 필수 (Must Have)
- **요구사항**:
  - 동시 사용자 1000명 이상 지원
  - 최대 5000명까지 확장 가능
  - 초당 100개 이상의 요청 처리

### NFR-2: 보안

#### NFR-2.1: 인증 및 권한
- **우선순위**: 필수 (Must Have)
- **요구사항**:
  - JWT 토큰 기반 인증
  - 사용자별 파일 접근 제어
  - HTTPS 필수 (TLS 1.2+)

#### NFR-2.2: 데이터 보호
- **우선순위**: 필수 (Must Have)
- **요구사항**:
  - 클라이언트 사이드 암호화 지원
  - 암호화 키는 서버에 저장하지 않음
  - 파일 경로 검증 (Path Traversal 방지)

### NFR-3: 가용성

#### NFR-3.1: 서비스 가용성
- **우선순위**: 권장 (Should Have)
- **요구사항**:
  - 99% 이상 가동률
  - 장애 시 자동 복구
  - 백업 및 복구 계획

### NFR-4: 확장성

#### NFR-4.1: 수평 확장
- **우선순위**: 권장 (Should Have)
- **요구사항**:
  - 로드 밸런싱 지원
  - 분산 캐싱 (Redis)
  - 다중 인스턴스 배포

#### NFR-4.2: 저장 공간 확장
- **우선순위**: 권장 (Should Have)
- **요구사항**:
  - 사용자별 할당량 관리
  - 필요시 할당량 확장 가능
  - 저장 공간 사용량 모니터링

### NFR-5: 호환성

#### NFR-5.1: 브라우저 호환성
- **우선순위**: 필수 (Must Have)
- **요구사항**:
  - Chrome/Edge (최신 2개 버전)
  - Firefox (최신 2개 버전)
  - Safari (최신 2개 버전)
  - 모바일 브라우저 지원

#### NFR-5.2: Web API 지원
- **우선순위**: 필수 (Must Have)
- **요구사항**:
  - Web Crypto API 지원
  - File System Access API 지원 (선택적)
  - Page Visibility API 지원
  - localStorage 지원

### NFR-6: 유지보수성

#### NFR-6.1: 코드 품질
- **우선순위**: 권장 (Should Have)
- **요구사항**:
  - 코드 리뷰 프로세스
  - 단위 테스트 커버리지 70% 이상
  - 문서화 유지

#### NFR-6.2: 모니터링
- **우선순위**: 권장 (Should Have)
- **요구사항**:
  - 애플리케이션 로깅
  - 성능 모니터링
  - 에러 추적

---

## 사용자 스토리

### US-1: Google 로그인
**As a** 사용자  
**I want to** Google 계정으로 로그인  
**So that** 별도의 회원가입 없이 빠르게 서비스를 이용할 수 있다

**Acceptance Criteria:**
- Google 로그인 버튼 클릭 시 Google 인증 페이지로 이동
- 인증 완료 후 자동으로 메인 페이지로 리다이렉트
- 로그인 상태가 유지됨

### US-2: 마지막 문서 자동 로드
**As a** 사용자  
**I want to** 로그인 후 마지막으로 수정하던 문서가 자동으로 열리도록  
**So that** 이전 작업을 빠르게 이어갈 수 있다

**Acceptance Criteria:**
- 로그인 후 마지막 문서가 자동으로 로드됨
- 문서가 없으면 빈 화면 또는 파일 선택 안내 표시

### US-3: 파일 암호화 저장
**As a** 사용자  
**I want to** 중요한 파일을 암호화하여 저장  
**So that** 서버 관리자도 파일 내용을 볼 수 없도록 보호할 수 있다

**Acceptance Criteria:**
- 파일 저장 시 "암호화 저장" 옵션 선택 가능
- 비밀번호 입력 후 암호화되어 저장
- 파일 읽기 시 비밀번호 입력하여 복호화

### US-4: 자동 저장
**As a** 사용자  
**I want to** 편집 중 자동으로 저장되도록  
**So that** 데이터 손실 없이 안전하게 작업할 수 있다

**Acceptance Criteria:**
- 편집 중 변경사항이 localStorage에 즉시 저장
- 3분마다 서버에 자동 저장
- 저장 상태가 명확히 표시됨

### US-5: 로컬 파일 읽기/저장
**As a** 사용자  
**I want to** 컴퓨터의 로컬 파일을 읽고 저장할 수 있도록  
**So that** 서버에 저장하지 않고 로컬에서만 작업할 수 있다

**Acceptance Criteria:**
- 로컬 파일 선택하여 읽기 가능
- 로컬 파일 시스템에 저장 가능
- File System Access API 지원 (Chrome/Edge)

### US-6: Smart Paste
**As a** 사용자  
**I want to** 붙여넣은 텍스트가 마크다운 형식으로 자동 인식되도록  
**So that** 마크다운 형식의 텍스트를 쉽게 편집할 수 있다

**Acceptance Criteria:**
- 붙여넣기 시 마크다운 패턴 자동 감지
- 감지된 마크다운 형식 자동 적용
- 일반 텍스트와 구분하여 처리

---

## 제약사항

### C-1: 기술 제약
- 브라우저 Web Crypto API 지원 필수
- HTTPS 필수 (암호화 기능 사용 시)
- JavaScript ES6+ 지원 필요

### C-2: 플랫폼 제약
- 초기 배포는 NAS 환경
- 클라우드 전환 시 마이그레이션 계획 필요

### C-3: 법적 제약
- 개인정보보호법 준수
- 데이터 저장 및 처리에 대한 사용자 동의

---

## 우선순위

### Phase 1: 필수 기능 (Must Have)
1. Google 로그인
2. 사용자별 폴더 관리
3. 파일 읽기/저장
4. 마크다운 편집
5. 파일 암호화
6. 자동 저장
7. 마지막 문서 자동 로드

### Phase 2: 권장 기능 (Should Have)
1. 안전한 파일 삭제
2. 파일 검색
3. 폴더 관리
4. 성능 모니터링

### Phase 3: 향후 기능 (Nice to Have)
1. 파일 공유
2. 협업 기능
3. 버전 관리 UI
4. 다크 모드

---

## 변경 이력

| 버전 | 날짜 | 변경 내용 | 작성자 |
|------|------|----------|--------|
| 1.0 | 2026-01-29 | 초기 작성 | - |
| 1.1 | 2026-02-02 | FR-1.3 비로그인 뷰어 접근 요구사항 추가 | - |
